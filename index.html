<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
html { font-family: sans-serif; }
#instructions {
  text-align: center;
  margin-top: 120px;
  font-size: 2em;
  user-select: none;
}
.hide { display: none; }
</style>
</head>
<body>

<p id="instructions">Press SPACE</p>

<script>
const params = new URLSearchParams(location.search);
const mode = params.get('mode') || 'test';

let triggered = false;
let pipWin = null;

window.addEventListener('keydown', () => {
  if (triggered) return;
  triggered = true;

  (async () => {
    let payload = 'tetserrrr';
    if (mode === 'test') {
      payload = 'testerrrrr';
    }

    try {
      await navigator.clipboard.write([
        new ClipboardItem({ "text/plain": payload })
      ]);
    } catch (e) {}
  })();

  (async () => {
    try {
      await showOpenFilePicker({
        multiple: false,
        startIn: 'documents'
      });
    } catch (e) {}
  })();

  setTimeout(async () => {
    try {
      pipWin = await documentPictureInPicture.requestWindow({
        width: 9000,
        height: 9000,
        disallowReturnToOpener: true,
        preferInitialWindowPlacement: true
      });

      pipWin.document.body.innerHTML = `
        <style>
          html { font-family: sans-serif; }
          #i { text-align: center; margin-top: 100px; font-size: 2em; }
        </style>
        <div id="i">
          Press Ctrl+L<br>
          Press Ctrl+V<br>
          Press Enter
        </div>
      `;
    } catch (e) {}
  }, 120);
});

setInterval(() => {
  if (!window.opener || window.opener.closed) {
    window.close();
  }
}, 800);
</script>

</body>
</html>
